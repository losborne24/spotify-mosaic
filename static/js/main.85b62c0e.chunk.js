(this["webpackJsonpspotify-playground"]=this["webpackJsonpspotify-playground"]||[]).push([[0],{104:function(e,t,a){},112:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),c=a(14),r=a.n(c),s=(a(83),a(15)),o=a(40),l=a(16),d=a(37),u=a(32),h=a.n(u),m=a(44),j="f1da744b65de4f5aaa1d3e3bb881d942",f="token",b="access_token=",p=a(146),g=a(155),v=a(153),O=a(154),x=a(149),y=(a(102),a(103),a(104),a(152)),k=a(145),w=a(2);y.a.use([k.a]);var C=function(e){var t=Object(l.f)(),a=Object(n.useState)([]),i=Object(s.a)(a,2),c=i[0],r=i[1],o=Object(n.useState)([]),u=Object(s.a)(o,2),y=u[0],k=u[1],C=Object(n.useState)(""),T=Object(s.a)(C,2),M=T[0],I=T[1],S=Object(n.useState)(0),N=Object(s.a)(S,2),F=N[0],_=N[1],U=Object(n.useState)(!1),E=Object(s.a)(U,2),A=E[0],D=E[1],R=function(){h.a.get("https://api.spotify.com/v1/me/playlists",{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)},params:{client_id:j,fields:"items(name,images,id)",response_type:f,limit:10,offset:F}}).then((function(e){var t,a,n=[];(null===(t=e.data)||void 0===t?void 0:t.items)&&e.data.items.forEach((function(e){n.push({img:e.images[0].url,id:e.id,name:e.name})})),F+10>=(null===(a=e.data)||void 0===a?void 0:a.total)?D(!1):D(!0),_((function(e){return e+10})),r((function(e){return[].concat(Object(d.a)(e),n)}))})).catch((function(e){console.log(e)}))};Object(n.useEffect)((function(){if(window.location.hash.includes(b)){var t,a=null===(t=window.location.hash.split(b).pop())||void 0===t?void 0:t.split("&")[0];a&&localStorage.setItem("token",a),e.setToken(a)}else e.setToken(localStorage.getItem("token"))}),[]),Object(n.useEffect)((function(){e.token&&(R(),h.a.get("https://api.spotify.com/v1/browse/categories/toplists/playlists",{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)},params:{client_id:j,fields:"items(name,images,id)",response_type:f,limit:10,offset:0}}).then((function(e){var t,a=[];(null===(t=e.data)||void 0===t?void 0:t.playlists.items)&&e.data.playlists.items.forEach((function(e){a.push({img:e.images[0].url,id:e.id,name:e.name})})),k(a)})).catch((function(e){console.log(e)})))}),[e.token]);var L=Object(p.a)({marginLeft:{marginLeft:"0.5rem"},marginRight:{marginRight:"0.5rem"},width100:{width:"100%"},widthXL:{width:"83%"},widthXS:{width:"17%"},playlistImage:{maxHeight:"14vw",maxWidth:"14vw"},playlistInputContainer:{display:"flex",alignItems:"center"},txtFlex:{display:"flex",justifyContent:"center",textAlign:"center",alignItems:"center"},swiperSlide:{display:"flex",alignItems:"center",flexDirection:"column",cursor:"pointer"},loadMore:{border:"0.1rem solid black",height:"14vw",width:"14vw"},playlistContainer:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},publicContainer:{flexDirection:"column",display:"flex",justifyContent:"center",alignItems:"center",width:"83%"},topTracksContainer:{flexDirection:"column",display:"flex",justifyContent:"center",textAlign:"center",alignItems:"center",width:"17%",height:"100%"},btnTopTrackContainer:{display:"flex",alignItems:"center",flexDirection:"column",height:"100%"},btnTopTracks:{width:"100%",margin:"0.5rem"}})();return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsxs)("div",{className:L.playlistContainer,children:[Object(w.jsxs)("div",{className:"".concat(L.publicContainer," "),children:[Object(w.jsx)("h2",{children:"Public Playlists"}),Object(w.jsx)(O.a,{slidesPerView:5,navigation:!0,className:L.width100,children:y.map((function(e,t){return Object(w.jsxs)(x.a,{className:"".concat(L.swiperSlide),onClick:function(){I(e.id)},children:[Object(w.jsx)("img",{className:"".concat(L.playlistImage),src:e.img,alt:"album cover"},"img-".concat(t)),Object(w.jsx)("p",{className:L.txtFlex,children:e.name})]},"swiper-slider-".concat(t," "))}))})]}),Object(w.jsxs)("div",{className:"".concat(L.topTracksContainer," "),children:[Object(w.jsx)("h2",{children:"Your Top Tracks"}),Object(w.jsx)("div",{className:L.btnTopTrackContainer,children:[{id:"short_term",text:"Short Term"},{id:"medium_term",text:"Medium Term"},{id:"long_term",text:"Long Term"}].map((function(a,n){return Object(w.jsx)(g.a,{className:"".concat(L.btnTopTracks),variant:"contained",color:"primary",onClick:function(){var n;n=a.id,h.a.get("https://api.spotify.com/v1/me/top/tracks",{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)},params:{time_range:n,limit:50,offset:0}}).then((function(a){var n;if(null===(n=a.data)||void 0===n?void 0:n.items){e.setFetchMoreUrl(null);var i=[],c=new m.a,r=[];a.data.items.forEach((function(e){r.find((function(t){return t.album.id===e.album.id}))||r.push(e)})),r.forEach((function(a){c.getColorAsync(a.album.images[2].url).then((function(n){i.push({id:a.album.id,img:a.album.images[2].url,avgColour:n.value}),i.length===r.length&&(e.setTracks(i),e.returnToMosaic?t.push("/createMosaic"):t.push("/selectImage"))}))}))}})).catch((function(e){console.log(e)}))},children:a.text})}))})]})," "]})," ",Object(w.jsx)("h2",{children:"Your Playlists"}),Object(w.jsxs)(O.a,{slidesPerView:6,navigation:!0,className:L.width100,children:[c.map((function(e,t){return Object(w.jsxs)(x.a,{className:"".concat(L.swiperSlide),onClick:function(){I(e.id)},children:[Object(w.jsx)("img",{className:"".concat(L.playlistImage),src:e.img,alt:"album cover"},"img-".concat(t)),Object(w.jsx)("p",{className:L.txtFlex,children:e.name})]},"swiper-slider-".concat(t," "))})),A?Object(w.jsxs)(x.a,{className:"".concat(L.swiperSlide),onClick:function(){return R()},children:[Object(w.jsx)("div",{className:"".concat(L.loadMore," ").concat(L.txtFlex),children:Object(w.jsx)("p",{children:"Load More"})}),Object(w.jsx)("p",{})]}):Object(w.jsx)(w.Fragment,{})]})," ",Object(w.jsxs)("div",{className:L.playlistInputContainer,children:[Object(w.jsx)(v.a,{label:"Enter Playlist ID",helperText:"e.g. 37i9dQZEVXbNG2KDcFcKOF",onChange:function(e){return I(e.target.value)},className:L.marginRight,value:M}),Object(w.jsx)(g.a,{className:L.marginLeft,variant:"contained",color:"primary",onClick:function(){return a=M,void h.a.get("https://api.spotify.com/v1/playlists/".concat(a,"/tracks"),{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)},params:{client_id:j,fields:"items(track(album(images,id))),total",response_type:f,limit:100,offset:0}}).then((function(n){var i;if(null===(i=n.data)||void 0===i?void 0:i.items){n.data.total>100&&e.setFetchMoreUrl("https://api.spotify.com/v1/playlists/".concat(a,"/tracks"));var c=[],r=new m.a,s=[];n.data.items.forEach((function(e){s.find((function(t){return t.track.album.id===e.track.album.id}))||s.push(e)})),e.setUniqueTracks(s),s.forEach((function(a){r.getColorAsync(a.track.album.images[2].url).then((function(n){c.push({id:a.track.album.id,img:a.track.album.images[2].url,avgColour:n.value}),c.length===s.length&&(e.setTracks(c),e.returnToMosaic?t.push("/createMosaic"):t.push("/selectImage"))}))}))}})).catch((function(e){console.log(e)}));var a},children:"Confirm"})]})]})},T=a(156),M=a(151),I=a(53),S=function(e){var t=Object(n.useState)(0),a=Object(s.a)(t,2),i=a[0],c=a[1],r=Object(n.useState)(0),o=Object(s.a)(r,2),u=o[0],b=o[1],v=Object(n.useState)(100),O=Object(s.a)(v,2),x=O[0],y=O[1],k=Object(n.useState)(!0),C=Object(s.a)(k,2),S=C[0],N=C[1],F=Object(n.useState)(),_=Object(s.a)(F,2),U=_[0],E=_[1],A=Object(n.useRef)(null),D=Object(n.useRef)(null),R=Object(l.f)(),L=Object(n.useState)(10),P=Object(s.a)(L,2),q=P[0],B=P[1],z=0,H=function(t,a){var n;t.drawImage(a,0,0,a.width,a.height);for(var i=null===(n=D.current)||void 0===n?void 0:n.getContext("2d"),c=function(n){for(var c=function(c){var r=Object(d.a)(t.getImageData(c,n,1,1).data);r[3]/=255;for(var s=0;s<3;s++)r[s]=r[s]*r[3]/255;for(var o=-1,l=0,u=0;u<e.tracks.length;u++){var h=Object(d.a)(e.tracks[u].avgColour);h[3]/=255;for(var m=0;m<3;m++)h[m]=h[m]*h[3]/255;var j=Math.max(Math.pow(r[0]-h[0],2),Math.pow(r[0]-h[0]-r[3]+h[3],2))+Math.max(Math.pow(r[1]-h[1],2),Math.pow(r[1]-h[1]-r[3]+h[3],2))+Math.max(Math.pow(r[2]-h[2],2),Math.pow(r[2]-h[2]-r[3]+h[3],2));(-1===o||j<o)&&(o=j,l=u)}var f=new Image;f.crossOrigin="anonymous",f.src=e.tracks[l].img,f.onload=function(){null===i||void 0===i||i.drawImage(f,64*c,64*n,f.width,f.height),function(e){++z===e.width*e.height&&D.current&&(E(D.current.toDataURL()),z=0,N(!1))}(a)}},r=0;r<a.width;r++)c(r)},r=0;r<a.height;r++)c(r)};Object(n.useEffect)((function(){if(e.imageSrc){var t=new Image;t.src=e.imageSrc,t.onload=function(){!function(e){var t,a=e.height,n=e.width;if(n*a>1e4){var i=n*a,r=Math.sqrt(i/1e4);e.height/=r,e.width/=r,b(e.height),c(e.width)}var s=null===(t=A.current)||void 0===t?void 0:t.getContext("2d");H(s,e)}(t)}}}),[e.img,e.tracks]);var V=Object(p.a)({scrollContainer:{maxHeight:"100%",maxWidth:"100%",display:"flex",alignItems:"center",justifyContent:"center"},outerContainer:{display:"grid",gridTemplateRows:"auto 1fr",height:"100%"},mosaicContainer:{display:"grid",gridTemplateRows:"1fr auto",height:"100%",minHeight:"0"},buttonContainer:{display:"flex",margin:"2rem 1.5rem","& > *":{margin:"0 0.5rem"}},sliderContainer:{margin:"2rem 4rem"},loadingContainer:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"}})();return Object(w.jsxs)("div",{className:V.outerContainer,children:[Object(w.jsxs)("div",{className:V.buttonContainer,children:[Object(w.jsx)(g.a,{variant:"contained",color:"primary",onClick:function(){e.setReturnToMosaic(!0),R.push("/playlists")},children:"Select New Playlist"}),Object(w.jsx)(g.a,{variant:"contained",color:"primary",onClick:function(){R.push("/selectImage")},children:"Upload New Image"}),Object(w.jsx)(g.a,{disabled:S||null===e.fetchMoreUrl,variant:"contained",color:"primary",onClick:function(){h.a.get(e.fetchMoreUrl,{headers:{Authorization:"Bearer ".concat(null===e||void 0===e?void 0:e.token)},params:{client_id:j,fields:"items(track(album(images,id))),total",response_type:f,limit:100,offset:x}}).then((function(t){var a;if(null===(a=t.data)||void 0===a?void 0:a.items){t.data.total>x+100?y(x+100):e.setFetchMoreUrl(null);var n=[],i=new m.a,c=e.uniqueTracks;t.data.items.forEach((function(e){c.find((function(t){return t.track.album.id===e.track.album.id}))||c.push(e)})),e.setUniqueTracks(c),c.forEach((function(t){i.getColorAsync(t.track.album.images[2].url).then((function(a){n.push({id:t.track.album.id,img:t.track.album.images[2].url,avgColour:a.value}),n.length===c.length&&(e.setTracks([].concat(Object(d.a)(e.tracks),n)),N(!0))}))}))}})).catch((function(e){console.log(e)}))},children:"Fetch More Tracks"}),Object(w.jsx)(g.a,{disabled:S,variant:"contained",color:"primary",onClick:function(){var e=document.createElement("a");e.href=U,e.setAttribute("download","mosaic.png"),document.body.appendChild(e),e.click()},children:"Download Mosaic"})]}),Object(w.jsx)("canvas",{hidden:!0,ref:A,width:i,height:u}),Object(w.jsx)("canvas",{hidden:!0,ref:D,width:64*i,height:64*u}),S?Object(w.jsx)("div",{className:V.loadingContainer,children:Object(w.jsx)(M.a,{})}):Object(w.jsxs)("div",{className:V.mosaicContainer,children:[Object(w.jsx)(I.a,{className:V.scrollContainer,children:Object(w.jsx)("img",{src:U,width:i*q,height:u*q})}),Object(w.jsx)("div",{className:V.sliderContainer,children:Object(w.jsx)(T.a,{value:q,onChange:function(e,t){B(t)},"aria-labelledby":"continuous-slider",min:1,max:64})})]})]})},N=a.p+"static/media/spotify.43abc2c0.png",F=function(){var e=Object(n.useState)(Math.floor(1e7*Math.random())),t=Object(s.a)(e,2),a=t[0],i=t[1],c=Object(p.a)({scrollContainer:{maxHeight:"80%",maxWidth:"80%",display:"flex",alignItems:"center",justifyContent:"center"},spotifyImg:{height:"100vh",width:"100vh"}})();return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(I.a,{className:c.scrollContainer,children:Object(w.jsx)("img",{src:N,className:c.spotifyImg})}),Object(w.jsx)("h1",{children:"Spotify Mosaic"}),Object(w.jsx)(g.a,{variant:"contained",color:"primary",onClick:function(){window.location.href="https://accounts.spotify.com/authorize?client_id=".concat(j,"&response_type=").concat(f,"&scope=").concat("user-top-read user-read-private user-read-email","&state=").concat(a,"&redirect_uri=").concat("https://losborne24.github.io/spotify-mosaic/"),i(Math.floor(1e7*Math.random()))},children:"Connect to Spotify"})]})},_=a(58),U=a.n(_),E=a(73),A=function(e){var t=Object(l.f)(),a=function(t){e.createImg(t)};return Object(w.jsx)(w.Fragment,{children:Object(w.jsxs)(g.a,{variant:"contained",color:"primary",component:"label",children:["Select Image",Object(w.jsx)("input",{hidden:!0,onChange:function(e){if(e.target.files.length>0){var n=e.target.files[0],i=new FileReader;i.readAsDataURL(n),i.onload=function(){var e=Object(E.a)(U.a.mark((function e(n){var c;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=i.result,e.next=3,a(c);case 3:t.push("/createMosaic");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},type:"file",accept:"image/*"})]})})},D=function(){var e=Object(n.useState)(),t=Object(s.a)(e,2),a=t[0],i=t[1],c=Object(n.useState)(null),r=Object(s.a)(c,2),d=r[0],u=r[1],h=Object(n.useState)([]),m=Object(s.a)(h,2),j=m[0],f=m[1],b=Object(n.useState)(""),g=Object(s.a)(b,2),v=g[0],O=g[1],x=Object(n.useState)([{id:"",img:"",avgColour:null}]),y=Object(s.a)(x,2),k=y[0],T=y[1],M=Object(n.useState)(!1),I=Object(s.a)(M,2),N=I[0],_=I[1],U=Object(p.a)({center:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center",height:"100%",width:"100%"}})();return Object(w.jsx)(o.a,{basename:"/spotify-mosaic",children:Object(w.jsxs)(l.c,{children:[Object(w.jsx)(l.a,{path:"/playlists",children:Object(w.jsx)("div",{className:U.center,children:Object(w.jsx)(C,{setToken:O,token:v,setTracks:T,returnToMosaic:N,setFetchMoreUrl:u,setUniqueTracks:f})})}),Object(w.jsx)(l.a,{path:"/:access_token(access_token=.*)",children:Object(w.jsx)("div",{className:U.center,children:Object(w.jsx)(C,{setToken:O,token:v,setTracks:T,returnToMosaic:N,setFetchMoreUrl:u,setUniqueTracks:f})})}),Object(w.jsx)(l.a,{path:"/selectImage",children:Object(w.jsx)("div",{className:U.center,children:Object(w.jsx)(A,{createImg:function(e){return function(e){i(e)}(e)}})})}),Object(w.jsx)(l.a,{path:"/createMosaic",children:Object(w.jsx)(S,{fetchMoreUrl:d,setFetchMoreUrl:u,token:v,tracks:k,imageSrc:a,setReturnToMosaic:_,setUniqueTracks:f,uniqueTracks:j,setTracks:T})}),Object(w.jsx)(l.a,{path:"/",children:Object(w.jsx)("div",{className:U.center,children:Object(w.jsx)(F,{})})})]})})},R=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,157)).then((function(t){var a=t.getCLS,n=t.getFID,i=t.getFCP,c=t.getLCP,r=t.getTTFB;a(e),n(e),i(e),c(e),r(e)}))};r.a.render(Object(w.jsx)(i.a.StrictMode,{children:Object(w.jsx)(D,{})}),document.getElementById("root")),R()},83:function(e,t,a){}},[[112,1,2]]]);
//# sourceMappingURL=main.85b62c0e.chunk.js.map