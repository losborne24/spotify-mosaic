(this["webpackJsonpspotify-playground"]=this["webpackJsonpspotify-playground"]||[]).push([[0],{106:function(t,e,a){},125:function(t,e,a){"use strict";a.r(e);var i=a(0),n=a.n(i),c=a(14),s=a.n(c),r=(a(85),a(20)),o=a(39),l=a(16),d=a(43),u=a(44),h=a.n(u),m=a(56),j="f1da744b65de4f5aaa1d3e3bb881d942",f="token",p="access_token=",b=a(156),g=a(164),v=a(162),O=a(163),x=a(159),w=(a(104),a(105),a(106),a(161)),y=a(155),k=a(3);w.a.use([y.a]);var C=function(t){var e=Object(l.f)(),a=Object(i.useState)([]),n=Object(r.a)(a,2),c=n[0],s=n[1],o=Object(i.useState)([]),u=Object(r.a)(o,2),w=u[0],y=u[1],C=Object(i.useState)(""),I=Object(r.a)(C,2),S=I[0],N=I[1],T=Object(i.useState)(0),M=Object(r.a)(T,2),F=M[0],_=M[1],D=Object(i.useState)(!1),E=Object(r.a)(D,2),L=E[0],A=E[1],P=function(){h.a.get("https://api.spotify.com/v1/me/playlists",{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:{client_id:j,fields:"items(name,images,id)",response_type:f,limit:10,offset:F}}).then((function(t){var e,a,i=[];(null===(e=t.data)||void 0===e?void 0:e.items)&&t.data.items.forEach((function(t){i.push({img:t.images[0].url,id:t.id,name:t.name})})),F+10>=(null===(a=t.data)||void 0===a?void 0:a.total)?A(!1):A(!0),_((function(t){return t+10})),s((function(t){return[].concat(Object(d.a)(t),i)}))})).catch((function(t){console.log(t)}))};Object(i.useEffect)((function(){var e,a;(null===(e=window.location.hash.split(p).pop())||void 0===e?void 0:e.split("&")[0])&&t.setToken(null===(a=window.location.hash.split(p).pop())||void 0===a?void 0:a.split("&")[0])}),[]),Object(i.useEffect)((function(){t.token&&(P(),h.a.get("https://api.spotify.com/v1/browse/categories/toplists/playlists",{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:{client_id:j,fields:"items(name,images,id)",response_type:f,limit:10,offset:0}}).then((function(t){var e,a=[];(null===(e=t.data)||void 0===e?void 0:e.playlists.items)&&t.data.playlists.items.forEach((function(t){a.push({img:t.images[0].url,id:t.id,name:t.name})})),y(a)})).catch((function(t){console.log(t)})))}),[t.token]);var R=Object(b.a)({marginLeft:{marginLeft:"0.5rem"},marginRight:{marginRight:"0.5rem"},width100:{width:"100%"},widthXL:{width:"83%"},widthXS:{width:"17%"},playlistImage:{maxHeight:"14vw",maxWidth:"14vw"},playlistInputContainer:{display:"flex",alignItems:"center"},txtFlex:{display:"flex",justifyContent:"center",textAlign:"center",alignItems:"center"},swiperSlide:{display:"flex",alignItems:"center",flexDirection:"column",cursor:"pointer"},loadMore:{border:"0.1rem solid black",height:"14vw",width:"14vw"},playlistContainer:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},publicContainer:{flexDirection:"column",display:"flex",justifyContent:"center",alignItems:"center",width:"83%"},topTracksContainer:{flexDirection:"column",display:"flex",justifyContent:"center",textAlign:"center",alignItems:"center",width:"17%",height:"100%"},btnTopTrackContainer:{display:"flex",alignItems:"center",flexDirection:"column",height:"100%"},btnTopTracks:{width:"100%",margin:"0.5rem"}})();return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)("div",{className:R.playlistContainer,children:[Object(k.jsxs)("div",{className:"".concat(R.publicContainer," "),children:[Object(k.jsx)("h2",{children:"Public Playlists"}),Object(k.jsx)(O.a,{slidesPerView:5,navigation:!0,className:R.width100,children:w.map((function(t,e){return Object(k.jsxs)(x.a,{className:"".concat(R.swiperSlide),onClick:function(){N(t.id)},children:[Object(k.jsx)("img",{className:"".concat(R.playlistImage),src:t.img,alt:"album cover"},"img-".concat(e)),Object(k.jsx)("p",{className:R.txtFlex,children:t.name})]},"swiper-slider-".concat(e," "))}))})]}),Object(k.jsxs)("div",{className:"".concat(R.topTracksContainer," "),children:[Object(k.jsx)("h2",{children:"Your Top Tracks"}),Object(k.jsx)("div",{className:R.btnTopTrackContainer,children:[{id:"short_term",text:"Short Term"},{id:"medium_term",text:"Medium Term"},{id:"long_term",text:"Long Term"}].map((function(a,i){return Object(k.jsx)(g.a,{className:"".concat(R.btnTopTracks),variant:"contained",color:"primary",onClick:function(){var i;i=a.id,h.a.get("https://api.spotify.com/v1/me/top/tracks",{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:{time_range:i,limit:50,offset:0}}).then((function(a){var i;if(null===(i=a.data)||void 0===i?void 0:i.items){var n=[],c=new m.a,s=[];a.data.items.forEach((function(t){s.find((function(e){return e.id===t.album.id}))||(s.push({id:t.album.id}),c.getColorAsync(t.album.images[2].url).then((function(e){n.push({id:t.album.id,img:t.album.images[2].url,avgColour:e.value})})))})),t.setTracks(n),e.push("/selectImage")}})).catch((function(t){console.log(t)}))},children:a.text})}))})]})," "]})," ",Object(k.jsx)("h2",{children:"Your Playlists"}),Object(k.jsxs)(O.a,{slidesPerView:6,navigation:!0,className:R.width100,children:[c.map((function(t,e){return Object(k.jsxs)(x.a,{className:"".concat(R.swiperSlide),onClick:function(){N(t.id)},children:[Object(k.jsx)("img",{className:"".concat(R.playlistImage),src:t.img,alt:"album cover"},"img-".concat(e)),Object(k.jsx)("p",{className:R.txtFlex,children:t.name})]},"swiper-slider-".concat(e," "))})),L?Object(k.jsxs)(x.a,{className:"".concat(R.swiperSlide),onClick:function(){return P()},children:[Object(k.jsx)("div",{className:"".concat(R.loadMore," ").concat(R.txtFlex),children:Object(k.jsx)("p",{children:"Load More"})}),Object(k.jsx)("p",{})]}):Object(k.jsx)(k.Fragment,{})]})," ",Object(k.jsxs)("div",{className:R.playlistInputContainer,children:[Object(k.jsx)(v.a,{label:"Enter Playlist ID",helperText:"e.g. 37i9dQZEVXbNG2KDcFcKOF",onChange:function(t){return N(t.target.value)},className:R.marginRight,value:S}),Object(k.jsx)(g.a,{className:R.marginLeft,variant:"contained",color:"primary",onClick:function(){return a=S,void h.a.get("https://api.spotify.com/v1/playlists/".concat(a,"/tracks"),{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:{client_id:j,fields:"items(track(album(images,id)))",response_type:f,limit:100,offset:0}}).then((function(a){var i;if(null===(i=a.data)||void 0===i?void 0:i.items){var n=[],c=new m.a,s=[];a.data.items.forEach((function(t){s.find((function(e){return e.id===t.track.album.id}))||(s.push({id:t.track.album.id}),c.getColorAsync(t.track.album.images[2].url).then((function(e){n.push({id:t.track.album.id,img:t.track.album.images[2].url,avgColour:e.value})})))})),t.setTracks(n),e.push("/selectImage")}})).catch((function(t){console.log(t)}));var a},children:"Confirm"})]})]})},I=a(75),S=function(t){var e=Object(i.useState)(0),a=Object(r.a)(e,2),n=a[0],c=a[1],s=Object(i.useState)(0),o=Object(r.a)(s,2),u=o[0],h=o[1],m=Object(i.useState)(),j=Object(r.a)(m,2),f=j[0],p=j[1],b=Object(i.useRef)(null),v=Object(i.useRef)(null),O=Object(l.f)(),x=0,w=function(e,a){var i;e.drawImage(a,0,0,a.width,a.height);for(var n=null===(i=v.current)||void 0===i?void 0:i.getContext("2d"),c=function(i){for(var c=function(c){var s=Object(d.a)(e.getImageData(c,i,1,1).data);s[3]/=255;for(var r=0;r<3;r++)s[r]=s[r]*s[3]/255;for(var o=-1,l=0,u=0;u<t.tracks.length;u++){var h=Object(d.a)(t.tracks[u].avgColour);h[3]/=255;for(var m=0;m<3;m++)h[m]=h[m]*h[3]/255;var j=Math.max(Math.pow(s[0]-h[0],2),Math.pow(s[0]-h[0]-s[3]+h[3],2))+Math.max(Math.pow(s[1]-h[1],2),Math.pow(s[1]-h[1]-s[3]+h[3],2))+Math.max(Math.pow(s[2]-h[2],2),Math.pow(s[2]-h[2]-s[3]+h[3],2));(-1===o||j<o)&&(o=j,l=u)}var f=new Image;f.crossOrigin="anonymous",f.src=t.tracks[l].img,f.onload=function(){null===n||void 0===n||n.drawImage(f,64*c,64*i,f.width,f.height),function(t){++x===t.width*t.height&&v.current&&(p(v.current.toDataURL()),x=0)}(a)}},s=0;s<a.width;s++)c(s)},s=0;s<a.height;s++)c(s)};"repeat(".concat(n,", 1fr)");return Object(i.useEffect)((function(){if(t.imageSrc){var e=new Image;e.src=t.imageSrc,e.onload=function(){!function(t){var e,a=t.height,i=t.width;if(i*a>1e4){var n=i*a,s=Math.sqrt(n/1e4);t.height/=s,t.width/=s,h(t.height),c(t.width)}var r=null===(e=b.current)||void 0===e?void 0:e.getContext("2d");w(r,t)}(e)}}}),[t.img]),Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(g.a,{onClick:function(){O.push("/playlists")},children:"Select New Playlist"}),Object(k.jsx)(g.a,{onClick:function(){O.push("/selectImage")},children:"Upload New Image"}),Object(k.jsx)("canvas",{hidden:!0,ref:b,width:n,height:u}),Object(k.jsx)("canvas",{hidden:!0,ref:v,width:64*n,height:64*u}),Object(k.jsx)(I.a,{smallImage:{alt:"Mosaic",width:8*n,height:8*u,isFluidWidth:!1,src:f},largeImage:{src:f,width:64*n,height:64*u}})]})},N=function(){var t=Object(i.useState)(Math.floor(1e7*Math.random())),e=Object(r.a)(t,2),a=e[0],n=e[1];return Object(k.jsx)(k.Fragment,{children:Object(k.jsx)(g.a,{variant:"contained",color:"primary",onClick:function(){window.location.href="https://accounts.spotify.com/authorize?client_id=".concat(j,"&response_type=").concat(f,"&scope=").concat("user-top-read user-read-private user-read-email","&state=").concat(a,"&redirect_uri=").concat("https://losborne24.github.io/spotify-mosaic/"),n(Math.floor(1e7*Math.random()))},children:"Connect to Spotify"})})},T=a(55),M=a.n(T),F=a(74),_=function(t){var e=Object(l.f)(),a=function(e){t.createImg(e)};return Object(k.jsx)(k.Fragment,{children:Object(k.jsxs)(g.a,{variant:"contained",color:"primary",component:"label",children:["Select Image",Object(k.jsx)("input",{hidden:!0,onChange:function(t){if(t.target.files.length>0){var i=t.target.files[0],n=new FileReader;n.readAsDataURL(i),n.onload=function(){var t=Object(F.a)(M.a.mark((function t(i){var c;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=n.result,t.next=3,a(c);case 3:e.push("/createMosaic");case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},type:"file",accept:"image/*"})]})})},D=function(){var t=Object(i.useState)(),e=Object(r.a)(t,2),a=e[0],n=e[1],c=Object(i.useState)(""),s=Object(r.a)(c,2),d=s[0],u=s[1],h=Object(i.useState)([{id:"",img:"",avgColour:null}]),m=Object(r.a)(h,2),j=m[0],f=m[1],p=Object(b.a)({center:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center",height:"100%",width:"100%"}})();return Object(k.jsx)(o.a,{basename:"/spotify-mosaic",children:Object(k.jsxs)(l.c,{children:[Object(k.jsx)(l.a,{path:"/playlists",children:Object(k.jsx)("div",{className:p.center,children:Object(k.jsx)(C,{setToken:u,token:d,setTracks:f})})}),Object(k.jsx)(l.a,{path:"/:access_token(access_token=.*)",children:Object(k.jsx)("div",{className:p.center,children:Object(k.jsx)(C,{setToken:u,token:d,setTracks:f})})}),Object(k.jsx)(l.a,{path:"/selectImage",children:Object(k.jsx)("div",{className:p.center,children:Object(k.jsx)(_,{createImg:function(t){return function(t){n(t)}(t)}})})}),Object(k.jsx)(l.a,{path:"/createMosaic",children:Object(k.jsx)(S,{tracks:j,imageSrc:a})}),Object(k.jsx)(l.a,{path:"/",children:Object(k.jsx)("div",{className:p.center,children:Object(k.jsx)(N,{})})})]})})},E=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,166)).then((function(e){var a=e.getCLS,i=e.getFID,n=e.getFCP,c=e.getLCP,s=e.getTTFB;a(t),i(t),n(t),c(t),s(t)}))};s.a.render(Object(k.jsx)(n.a.StrictMode,{children:Object(k.jsx)(D,{})}),document.getElementById("root")),E()},85:function(t,e,a){}},[[125,1,2]]]);
//# sourceMappingURL=main.37a49a96.chunk.js.map