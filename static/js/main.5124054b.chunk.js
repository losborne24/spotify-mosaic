(this["webpackJsonpspotify-playground"]=this["webpackJsonpspotify-playground"]||[]).push([[0],{105:function(t,e,a){},116:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),c=a(14),r=a.n(c),s=(a(84),a(15)),o=a(39),l=a(16),d=a(36),u=a(41),h=a.n(u),m=a(53),j="f1da744b65de4f5aaa1d3e3bb881d942",p="token",b="access_token=",f="state=",g="/createMosaic",O="/playlists",v="/selectImage",x=a(150),y=a(153),w=a(159),k=a(157),C=a(158),S=a(155),T=(a(103),a(104),a(105),a(156)),I=a(149),M=a(2);T.a.use([I.a]);var N=function(t){var e,a,i=Object(l.f)(),c=Object(n.useState)([]),r=Object(s.a)(c,2),o=r[0],u=r[1],O=Object(n.useState)(!0),T=Object(s.a)(O,2),I=T[0],N=T[1],F=Object(n.useState)(!0),U=Object(s.a)(F,2),E=U[0],_=U[1],D=Object(n.useState)([]),P=Object(s.a)(D,2),R=P[0],A=P[1],L=Object(n.useState)(""),q=Object(s.a)(L,2),B=q[0],z=q[1],H=Object(n.useState)(0),W=Object(s.a)(H,2),J=W[0],Q=W[1],V=Object(n.useState)(!1),G=Object(s.a)(V,2),K=G[0],X=G[1];!function(t){t[t.public=0]="public",t[t.personal=1]="personal"}(e||(e={})),function(t){t[t.playlist=0]="playlist",t[t.top=1]="top"}(a||(a={}));var Y=function(a){var n=a===e.public?"https://api.spotify.com/v1/browse/categories/toplists/playlists":"https://api.spotify.com/v1/me/playlists";h.a.get(n,{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:{client_id:j,fields:"items(name,images,id)",response_type:p,limit:10,offset:a===e.public?0:J}}).then((function(t){var n,i=[];t.data&&(a===e.public?t.data.playlists.items:t.data.items).forEach((function(t){i.push({img:t.images[0].url,id:t.id,name:t.name})}));a===e.public?(A(i),_(!1)):(X(J+10<(null===(n=t.data)||void 0===n?void 0:n.total)),Q(J+10),u((function(t){return[].concat(Object(d.a)(t),i)})),N(!1))})).catch((function(t){console.log(t)}))},Z=function(e,n){var c=e===a.playlist?"https://api.spotify.com/v1/playlists/".concat(n,"/tracks"):"https://api.spotify.com/v1/me/top/tracks",r=e===a.playlist?{client_id:j,fields:"items(track(album(images,id))),total",response_type:p,limit:100,offset:0}:{time_range:n,limit:50,offset:0};h.a.get(c,{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:r}).then((function(c){var r;if(null===(r=c.data)||void 0===r?void 0:r.items){c.data.total>100&&e===a.playlist?t.setFetchMoreUrl("https://api.spotify.com/v1/playlists/".concat(n,"/tracks")):t.setFetchMoreUrl(null);var s=[],o=new m.a,l=[];c.data.items.forEach((function(t){e===a.playlist?l.find((function(e){return e.track.album.id===t.track.album.id}))||l.push(t):l.find((function(e){return e.album.id===t.album.id}))||l.push(t)})),e===a.playlist&&t.setUniqueTracks(l),l.forEach((function(n){var c=e===a.playlist?n.track:n;o.getColorAsync(c.album.images[2].url).then((function(e){s.push({id:c.album.id,img:c.album.images[2].url,avgColour:e.value}),s.length===l.length&&(t.setTracks(s),t.returnToMosaic?i.push(g):i.push(v))}))}))}})).catch((function(t){console.log(t)}))};Object(n.useEffect)((function(){var e,a="";window.location.hash.includes(f)&&(a=null===(e=window.location.hash.split(f).pop())||void 0===e?void 0:e.split("&")[0]);if(a===localStorage.getItem("authState")&&window.location.hash.includes(b)){var n,i=null===(n=window.location.hash.split(b).pop())||void 0===n?void 0:n.split("&")[0];i&&localStorage.setItem("token",i),t.setToken(i)}else t.setToken(localStorage.getItem("token"))}),[]),Object(n.useEffect)((function(){t.token&&(Y(e.public),Y(e.personal))}),[t.token]);var $=Object(x.a)({marginLeft:{marginLeft:"0.5rem"},txtPlaylistUrl:{marginRight:"0.5rem",flexBasis:"50%"},width100:{width:"100%"},playlistImage:{maxHeight:"14vw",maxWidth:"14vw"},playlistInputContainer:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},txtFlex:{display:"flex",justifyContent:"center",textAlign:"center",alignItems:"center"},swiperSlide:{display:"flex",alignItems:"center",flexDirection:"column",cursor:"pointer"},loadMore:{border:"0.1rem solid black",height:"14vw",width:"14vw"},playlistContainer:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},publicContainer:{flexDirection:"column",display:"flex",justifyContent:"center",alignItems:"center",width:"83%"},topTracksContainer:{flexDirection:"column",display:"flex",justifyContent:"center",textAlign:"center",alignItems:"center",width:"17%",height:"100%"},btnTopTrackContainer:{display:"flex",alignItems:"center",flexDirection:"column",height:"100%"},btnTopTracks:{width:"100%",margin:"0.5rem"},loadingContainer:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"}})();return Object(M.jsx)(M.Fragment,{children:I||E?Object(M.jsx)("div",{className:$.loadingContainer,children:Object(M.jsx)(y.a,{})}):Object(M.jsxs)(M.Fragment,{children:[Object(M.jsxs)("div",{className:$.playlistContainer,children:[Object(M.jsxs)("div",{className:"".concat($.publicContainer," "),children:[Object(M.jsx)("h2",{children:"Public Playlists"}),Object(M.jsx)(C.a,{slidesPerView:5,navigation:!0,className:$.width100,children:R.map((function(t,e){return Object(M.jsxs)(S.a,{className:"".concat($.swiperSlide),onClick:function(){z(t.id)},children:[Object(M.jsx)("img",{className:"".concat($.playlistImage),src:t.img,alt:"album cover"},"img-".concat(e)),Object(M.jsx)("p",{className:$.txtFlex,children:t.name})]},"swiper-slider-".concat(e," "))}))})]}),Object(M.jsxs)("div",{className:"".concat($.topTracksContainer," "),children:[Object(M.jsx)("h2",{children:"Your Top Tracks"}),Object(M.jsx)("div",{className:$.btnTopTrackContainer,children:[{id:"short_term",text:"Short Term"},{id:"medium_term",text:"Medium Term"},{id:"long_term",text:"Long Term"}].map((function(t){return Object(M.jsx)(w.a,{className:"".concat($.btnTopTracks),variant:"contained",color:"primary",onClick:function(){Z(a.top,t.id)},children:t.text})}))})]})," "]})," ",Object(M.jsx)("h2",{children:"Your Playlists"}),Object(M.jsxs)(C.a,{slidesPerView:6,navigation:!0,className:$.width100,children:[o.map((function(t,e){return Object(M.jsxs)(S.a,{className:"".concat($.swiperSlide),onClick:function(){z(t.id)},children:[Object(M.jsx)("img",{className:"".concat($.playlistImage),src:t.img,alt:"album cover"},"img-".concat(e)),Object(M.jsx)("p",{className:$.txtFlex,children:t.name})]},"swiper-slider-".concat(e," "))})),K?Object(M.jsxs)(S.a,{className:"".concat($.swiperSlide),onClick:function(){return Y(e.personal)},children:[Object(M.jsx)("div",{className:"".concat($.loadMore," ").concat($.txtFlex),children:Object(M.jsx)("p",{children:"Load More"})}),Object(M.jsx)("p",{})]}):Object(M.jsx)(M.Fragment,{})]}),Object(M.jsxs)("div",{className:$.playlistInputContainer,children:[Object(M.jsx)(k.a,{label:"Enter Playlist ID",helperText:"e.g. 37i9dQZEVXbNG2KDcFcKOF",onChange:function(t){return z(t.target.value)},className:$.txtPlaylistUrl,value:B}),Object(M.jsx)(w.a,{className:$.marginLeft,variant:"contained",color:"primary",onClick:function(){return Z(a.playlist,B)},children:"Confirm"})]})]})})},F=a(160),U=a(52),E=function(t){var e=Object(n.useState)(0),a=Object(s.a)(e,2),i=a[0],c=a[1],r=Object(n.useState)(0),o=Object(s.a)(r,2),u=o[0],b=o[1],f=Object(n.useState)(100),g=Object(s.a)(f,2),k=g[0],C=g[1],S=Object(n.useState)(!0),T=Object(s.a)(S,2),I=T[0],N=T[1],E=Object(n.useState)(),_=Object(s.a)(E,2),D=_[0],P=_[1],R=Object(n.useRef)(null),A=Object(n.useRef)(null),L=Object(l.f)(),q=Object(n.useState)(10),B=Object(s.a)(q,2),z=B[0],H=B[1],W=0,J=function(e,a){var n;e.drawImage(a,0,0,a.width,a.height);for(var i=null===(n=A.current)||void 0===n?void 0:n.getContext("2d"),c=function(n){for(var c=function(c){var r=Object(d.a)(e.getImageData(c,n,1,1).data);r[3]/=255;for(var s=0;s<3;s++)r[s]=r[s]*r[3]/255;for(var o=-1,l=0,u=0;u<t.tracks.length;u++){var h=Object(d.a)(t.tracks[u].avgColour);h[3]/=255;for(var m=0;m<3;m++)h[m]=h[m]*h[3]/255;var j=Math.max(Math.pow(r[0]-h[0],2),Math.pow(r[0]-h[0]-r[3]+h[3],2))+Math.max(Math.pow(r[1]-h[1],2),Math.pow(r[1]-h[1]-r[3]+h[3],2))+Math.max(Math.pow(r[2]-h[2],2),Math.pow(r[2]-h[2]-r[3]+h[3],2));(-1===o||j<o)&&(o=j,l=u)}var p=new Image;p.crossOrigin="anonymous",p.src=t.tracks[l].img,p.onload=function(){null===i||void 0===i||i.drawImage(p,64*c,64*n,p.width,p.height),function(t){++W===t.width*t.height&&A.current&&(P(A.current.toDataURL()),W=0,N(!1))}(a)}},r=0;r<a.width;r++)c(r)},r=0;r<a.height;r++)c(r)};Object(n.useEffect)((function(){if(t.imageSrc){var e=new Image;e.src=t.imageSrc,e.onload=function(){!function(t){var e,a=t.height,n=t.width;if(n*a>1e4){var i=n*a,r=Math.sqrt(i/1e4);t.height/=r,t.width/=r,b(t.height),c(t.width)}var s=null===(e=R.current)||void 0===e?void 0:e.getContext("2d");J(s,t)}(e)}}}),[t.img,t.tracks]);var Q=Object(x.a)({scrollContainer:{maxHeight:"100%",maxWidth:"100%",display:"flex",alignItems:"center",justifyContent:"center"},outerContainer:{display:"grid",gridTemplateRows:"auto 1fr",height:"100%"},mosaicContainer:{display:"grid",gridTemplateRows:"1fr auto",height:"100%",minHeight:"0"},buttonContainer:{display:"flex",margin:"2rem 1.5rem",overflowX:"auto","& > *":{margin:"0 0.5rem"}},sliderContainer:{margin:"2rem 4rem"},loadingContainer:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"}})();return Object(M.jsxs)("div",{className:Q.outerContainer,children:[Object(M.jsxs)("div",{className:Q.buttonContainer,children:[Object(M.jsx)(w.a,{variant:"contained",color:"primary",onClick:function(){t.setReturnToMosaic(!0),L.push(O)},children:"Select New Playlist"}),Object(M.jsx)(w.a,{variant:"contained",color:"primary",onClick:function(){L.push(v)},children:"Upload New Image"}),Object(M.jsx)(w.a,{disabled:I||null===t.fetchMoreUrl,variant:"contained",color:"primary",onClick:function(){h.a.get(t.fetchMoreUrl,{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:{client_id:j,fields:"items(track(album(images,id))),total",response_type:p,limit:100,offset:k}}).then((function(e){var a;if(null===(a=e.data)||void 0===a?void 0:a.items){e.data.total>k+100?C(k+100):t.setFetchMoreUrl(null);var n=[],i=new m.a,c=t.uniqueTracks;e.data.items.forEach((function(t){c.find((function(e){return e.track.album.id===t.track.album.id}))||c.push(t)})),t.setUniqueTracks(c),c.forEach((function(e){i.getColorAsync(e.track.album.images[2].url).then((function(a){n.push({id:e.track.album.id,img:e.track.album.images[2].url,avgColour:a.value}),n.length===c.length&&(t.setTracks([].concat(Object(d.a)(t.tracks),n)),N(!0))}))}))}})).catch((function(t){console.log(t)}))},children:"Fetch More Tracks"}),Object(M.jsx)(w.a,{disabled:I,variant:"contained",color:"primary",onClick:function(){var t=document.createElement("a");t.href=D,t.setAttribute("download","mosaic.png"),document.body.appendChild(t),t.click()},children:"Download Mosaic"})]}),Object(M.jsx)("canvas",{hidden:!0,ref:R,width:i,height:u}),Object(M.jsx)("canvas",{hidden:!0,ref:A,width:64*i,height:64*u}),I?Object(M.jsx)("div",{className:Q.loadingContainer,children:Object(M.jsx)(y.a,{})}):Object(M.jsxs)("div",{className:Q.mosaicContainer,children:[Object(M.jsx)(U.a,{className:Q.scrollContainer,children:Object(M.jsx)("img",{src:D,width:i*z,height:u*z,alt:"mosaic"})}),Object(M.jsx)("div",{className:Q.sliderContainer,children:Object(M.jsx)(F.a,{value:z,onChange:function(t,e){H(e)},"aria-labelledby":"continuous-slider",min:1,max:64})})]})]})},_=a.p+"static/media/spotify.43abc2c0.png",D=function(){var t=Object(x.a)({scrollContainer:{maxHeight:"80%",maxWidth:"70%",display:"flex",alignItems:"center",justifyContent:"center"},spotifyImg:{height:"100vh",width:"100vh"},btnConnect:{margin:"2rem"}})();return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("h1",{children:"Spotify Mosaic"}),Object(M.jsx)(U.a,{className:t.scrollContainer,children:Object(M.jsx)("img",{src:_,className:t.spotifyImg,alt:"Spotify Mosaic"})}),Object(M.jsx)(w.a,{variant:"contained",color:"primary",onClick:function(){var t=String(Math.floor(1e7*Math.random()));localStorage.setItem("authState",t),window.location.href="https://accounts.spotify.com/authorize?client_id=".concat(j,"&response_type=").concat(p,"&scope=").concat("user-top-read user-read-private user-read-email","&state=").concat(t,"&redirect_uri=").concat("https://losborne24.github.io/spotify-mosaic/playlists")},className:t.btnConnect,children:"Connect to Spotify"})]})},P=a(58),R=a.n(P),A=a(74),L=function(t){var e=Object(l.f)(),a=function(e){t.createImg(e)};return Object(M.jsx)(M.Fragment,{children:Object(M.jsxs)(w.a,{variant:"contained",color:"primary",component:"label",children:["Select Image",Object(M.jsx)("input",{hidden:!0,onChange:function(t){if(t.target.files.length>0){var n=t.target.files[0],i=new FileReader;i.readAsDataURL(n),i.onload=function(){var t=Object(A.a)(R.a.mark((function t(n){var c;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=i.result,t.next=3,a(c);case 3:e.push(g);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},type:"file",accept:"image/*"})]})})},q=a(59),B=a.n(q),z=a(22);Object(z.a)().listen((function(t){console.log(t),B.a.send(t)}));var H=function(){var t=Object(n.useState)(),e=Object(s.a)(t,2),a=e[0],i=e[1],c=Object(n.useState)(null),r=Object(s.a)(c,2),d=r[0],u=r[1],h=Object(n.useState)([]),m=Object(s.a)(h,2),j=m[0],p=m[1],b=Object(n.useState)(""),f=Object(s.a)(b,2),y=f[0],w=f[1],k=Object(n.useState)([{id:"",img:"",avgColour:null}]),C=Object(s.a)(k,2),S=C[0],T=C[1],I=Object(n.useState)(!1),F=Object(s.a)(I,2),U=F[0],_=F[1];Object(n.useEffect)((function(){B.a.initialize("G-JQQCW8E695")}),[]);var P=Object(x.a)({center:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center",height:"100%",width:"100%"}})();return Object(M.jsx)(o.a,{children:Object(M.jsxs)(l.c,{children:[Object(M.jsx)(l.a,{path:O,children:Object(M.jsx)("div",{className:P.center,children:Object(M.jsx)(N,{setToken:w,token:y,setTracks:T,returnToMosaic:U,setFetchMoreUrl:u,setUniqueTracks:p})})}),Object(M.jsx)(l.a,{path:v,children:Object(M.jsx)("div",{className:P.center,children:Object(M.jsx)(L,{createImg:function(t){return function(t){i(t)}(t)}})})}),Object(M.jsx)(l.a,{path:g,children:Object(M.jsx)(E,{fetchMoreUrl:d,setFetchMoreUrl:u,token:y,tracks:S,imageSrc:a,setReturnToMosaic:_,setUniqueTracks:p,uniqueTracks:j,setTracks:T})}),Object(M.jsx)(l.a,{path:"/",children:Object(M.jsx)("div",{className:P.center,children:Object(M.jsx)(D,{})})})]})})},W=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,161)).then((function(e){var a=e.getCLS,n=e.getFID,i=e.getFCP,c=e.getLCP,r=e.getTTFB;a(t),n(t),i(t),c(t),r(t)}))};r.a.render(Object(M.jsx)(i.a.StrictMode,{children:Object(M.jsx)(H,{})}),document.getElementById("root")),W()},84:function(t,e,a){}},[[116,1,2]]]);
//# sourceMappingURL=main.5124054b.chunk.js.map