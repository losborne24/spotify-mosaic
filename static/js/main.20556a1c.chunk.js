(this["webpackJsonpspotify-playground"]=this["webpackJsonpspotify-playground"]||[]).push([[0],{105:function(t,e,a){},113:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),c=a(14),s=a.n(c),r=(a(84),a(15)),o=a(33),l=a(16),d=a(37),u=a(41),h=a.n(u),m=a(53),j="f1da744b65de4f5aaa1d3e3bb881d942",p="token",b="access_token=",f="state=",g="/createMosaic",O="/playlists",x="/selectImage",v=a(147),y=a(150),k=a(156),w=a(154),C=a(155),T=a(152),S=(a(103),a(104),a(105),a(153)),M=a(146),N=a(2);S.a.use([M.a]);var I=function(t){var e,a,i=Object(l.k)(),c=Object(n.useState)([]),s=Object(r.a)(c,2),o=s[0],u=s[1],O=Object(n.useState)(!0),S=Object(r.a)(O,2),M=S[0],I=S[1],F=Object(n.useState)(!0),U=Object(r.a)(F,2),_=U[0],D=U[1],E=Object(n.useState)([]),P=Object(r.a)(E,2),R=P[0],L=P[1],A=Object(n.useState)(""),q=Object(r.a)(A,2),B=q[0],H=q[1],z=Object(n.useState)(0),X=Object(r.a)(z,2),G=X[0],V=X[1],W=Object(n.useState)(!1),J=Object(r.a)(W,2),K=J[0],Q=J[1];!function(t){t[t.public=0]="public",t[t.personal=1]="personal"}(e||(e={})),function(t){t[t.playlist=0]="playlist",t[t.top=1]="top"}(a||(a={}));var Y=function(a){var n=a===e.public?"https://api.spotify.com/v1/browse/categories/toplists/playlists":"https://api.spotify.com/v1/me/playlists";h.a.get(n,{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:{client_id:j,fields:"items(name,images,id)",response_type:p,limit:10,offset:a===e.public?0:G}}).then((function(t){var n,i=[];t.data&&(a===e.public?t.data.playlists.items:t.data.items).forEach((function(t){i.push({img:t.images[0].url,id:t.id,name:t.name})}));a===e.public?(L(i),D(!1)):(Q(G+10<(null===(n=t.data)||void 0===n?void 0:n.total)),V(G+10),u((function(t){return[].concat(Object(d.a)(t),i)})),I(!1))})).catch((function(t){console.log(t)}))},Z=function(e,n){var c=e===a.playlist?"https://api.spotify.com/v1/playlists/".concat(n,"/tracks"):"https://api.spotify.com/v1/me/top/tracks",s=e===a.playlist?{client_id:j,fields:"items(track(album(images,id))),total",response_type:p,limit:100,offset:0}:{time_range:n,limit:50,offset:0};h.a.get(c,{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:s}).then((function(c){var s;if(null===(s=c.data)||void 0===s?void 0:s.items){c.data.total>100&&e===a.playlist?t.setFetchMoreUrl("https://api.spotify.com/v1/playlists/".concat(n,"/tracks")):t.setFetchMoreUrl(null);var r=[],o=new m.a,l=[];c.data.items.forEach((function(t){e===a.playlist?l.find((function(e){return e.track.album.id===t.track.album.id}))||l.push(t):l.find((function(e){return e.album.id===t.album.id}))||l.push(t)})),e===a.playlist&&t.setUniqueTracks(l),l.forEach((function(n){var c=e===a.playlist?n.track:n;o.getColorAsync(c.album.images[2].url).then((function(e){r.push({id:c.album.id,img:c.album.images[2].url,avgColour:e.value}),r.length===l.length&&(t.setTracks(r),t.returnToMosaic?i.push(g):i.push(x))}))}))}})).catch((function(t){console.log(t)}))};Object(n.useEffect)((function(){var e,a="";window.location.hash.includes(f)&&(a=null===(e=window.location.hash.split(f).pop())||void 0===e?void 0:e.split("&")[0]);if(a===localStorage.getItem("authState")&&window.location.hash.includes(b)){var n,i=null===(n=window.location.hash.split(b).pop())||void 0===n?void 0:n.split("&")[0];i&&localStorage.setItem("token",i),t.setToken(i)}else t.setToken(localStorage.getItem("token"))}),[]),Object(n.useEffect)((function(){t.token&&(Y(e.public),Y(e.personal))}),[t.token]);var $=Object(v.a)({marginLeft:{marginLeft:"0.5rem"},txtPlaylistUrl:{marginRight:"0.5rem",flexBasis:"50%"},width100:{width:"100%"},playlistImage:{maxHeight:"14vw",maxWidth:"14vw"},playlistInputContainer:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},txtFlex:{display:"flex",justifyContent:"center",textAlign:"center",alignItems:"center"},swiperSlide:{display:"flex",alignItems:"center",flexDirection:"column",cursor:"pointer"},loadMore:{border:"0.1rem solid black",height:"14vw",width:"14vw"},playlistContainer:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},publicContainer:{flexDirection:"column",display:"flex",justifyContent:"center",alignItems:"center",width:"83%"},topTracksContainer:{flexDirection:"column",display:"flex",justifyContent:"center",textAlign:"center",alignItems:"center",width:"17%",height:"100%"},btnTopTrackContainer:{display:"flex",alignItems:"center",flexDirection:"column",height:"100%"},btnTopTracks:{width:"100%",margin:"0.5rem"},loadingContainer:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"}})();return Object(N.jsx)(N.Fragment,{children:M||_?Object(N.jsx)("div",{className:$.loadingContainer,children:Object(N.jsx)(y.a,{})}):Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)("div",{className:$.playlistContainer,children:[Object(N.jsxs)("div",{className:"".concat($.publicContainer," "),children:[Object(N.jsx)("h2",{children:"Public Playlists"}),Object(N.jsx)(C.a,{slidesPerView:5,navigation:!0,className:$.width100,children:R.map((function(t,e){return Object(N.jsxs)(T.a,{className:"".concat($.swiperSlide),onClick:function(){H(t.id)},children:[Object(N.jsx)("img",{className:"".concat($.playlistImage),src:t.img,alt:"album cover"},"img-".concat(e)),Object(N.jsx)("p",{className:$.txtFlex,children:t.name})]},"swiper-slider-".concat(e," "))}))})]}),Object(N.jsxs)("div",{className:"".concat($.topTracksContainer," "),children:[Object(N.jsx)("h2",{children:"Your Top Tracks"}),Object(N.jsx)("div",{className:$.btnTopTrackContainer,children:[{id:"short_term",text:"Short Term"},{id:"medium_term",text:"Medium Term"},{id:"long_term",text:"Long Term"}].map((function(t){return Object(N.jsx)(k.a,{className:"".concat($.btnTopTracks),variant:"contained",color:"primary",onClick:function(){Z(a.top,t.id)},children:t.text})}))})]})," "]})," ",Object(N.jsx)("h2",{children:"Your Playlists"}),Object(N.jsxs)(C.a,{slidesPerView:6,navigation:!0,className:$.width100,children:[o.map((function(t,e){return Object(N.jsxs)(T.a,{className:"".concat($.swiperSlide),onClick:function(){H(t.id)},children:[Object(N.jsx)("img",{className:"".concat($.playlistImage),src:t.img,alt:"album cover"},"img-".concat(e)),Object(N.jsx)("p",{className:$.txtFlex,children:t.name})]},"swiper-slider-".concat(e," "))})),K?Object(N.jsxs)(T.a,{className:"".concat($.swiperSlide),onClick:function(){return Y(e.personal)},children:[Object(N.jsx)("div",{className:"".concat($.loadMore," ").concat($.txtFlex),children:Object(N.jsx)("p",{children:"Load More"})}),Object(N.jsx)("p",{})]}):Object(N.jsx)(N.Fragment,{})]}),Object(N.jsxs)("div",{className:$.playlistInputContainer,children:[Object(N.jsx)(w.a,{label:"Enter Playlist ID",helperText:"e.g. 37i9dQZEVXbNG2KDcFcKOF",onChange:function(t){return H(t.target.value)},className:$.txtPlaylistUrl,value:B}),Object(N.jsx)(k.a,{className:$.marginLeft,variant:"contained",color:"primary",onClick:function(){return Z(a.playlist,B)},children:"Confirm"})]})]})})},F=a(157),U=a(52),_=function(t){var e=Object(n.useState)(0),a=Object(r.a)(e,2),i=a[0],c=a[1],s=Object(n.useState)(0),o=Object(r.a)(s,2),u=o[0],b=o[1],f=Object(n.useState)(100),g=Object(r.a)(f,2),w=g[0],C=g[1],T=Object(n.useState)(!0),S=Object(r.a)(T,2),M=S[0],I=S[1],_=Object(n.useState)(),D=Object(r.a)(_,2),E=D[0],P=D[1],R=Object(n.useRef)(null),L=Object(n.useRef)(null),A=Object(l.k)(),q=Object(n.useState)(10),B=Object(r.a)(q,2),H=B[0],z=B[1],X=0,G=function(e,a){var n;e.drawImage(a,0,0,a.width,a.height);for(var i=null===(n=L.current)||void 0===n?void 0:n.getContext("2d"),c=function(n){for(var c=function(c){var s=Object(d.a)(e.getImageData(c,n,1,1).data);s[3]/=255;for(var r=0;r<3;r++)s[r]=s[r]*s[3]/255;for(var o=-1,l=0,u=0;u<t.tracks.length;u++){var h=Object(d.a)(t.tracks[u].avgColour);h[3]/=255;for(var m=0;m<3;m++)h[m]=h[m]*h[3]/255;var j=Math.max(Math.pow(s[0]-h[0],2),Math.pow(s[0]-h[0]-s[3]+h[3],2))+Math.max(Math.pow(s[1]-h[1],2),Math.pow(s[1]-h[1]-s[3]+h[3],2))+Math.max(Math.pow(s[2]-h[2],2),Math.pow(s[2]-h[2]-s[3]+h[3],2));(-1===o||j<o)&&(o=j,l=u)}var p=new Image;p.crossOrigin="anonymous",p.src=t.tracks[l].img,p.onload=function(){null===i||void 0===i||i.drawImage(p,64*c,64*n,p.width,p.height),function(t){++X===t.width*t.height&&L.current&&(P(L.current.toDataURL()),X=0,I(!1))}(a)}},s=0;s<a.width;s++)c(s)},s=0;s<a.height;s++)c(s)};Object(n.useEffect)((function(){if(t.imageSrc){var e=new Image;e.src=t.imageSrc,e.onload=function(){!function(t){var e,a=t.height,n=t.width;if(n*a>1e4){var i=n*a,s=Math.sqrt(i/1e4);t.height/=s,t.width/=s,b(t.height),c(t.width)}var r=null===(e=R.current)||void 0===e?void 0:e.getContext("2d");G(r,t)}(e)}}}),[t.img,t.tracks]);var V=Object(v.a)({scrollContainer:{maxHeight:"100%",maxWidth:"100%",display:"flex",alignItems:"center",justifyContent:"center"},outerContainer:{display:"grid",gridTemplateRows:"auto 1fr",height:"100%"},mosaicContainer:{display:"grid",gridTemplateRows:"1fr auto",height:"100%",minHeight:"0"},buttonContainer:{display:"flex",margin:"2rem 1.5rem",overflowX:"auto","& > *":{margin:"0 0.5rem"}},sliderContainer:{margin:"2rem 4rem"},loadingContainer:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"}})();return Object(N.jsxs)("div",{className:V.outerContainer,children:[Object(N.jsxs)("div",{className:V.buttonContainer,children:[Object(N.jsx)(k.a,{variant:"contained",color:"primary",onClick:function(){t.setReturnToMosaic(!0),A.push(O)},children:"Select New Playlist"}),Object(N.jsx)(k.a,{variant:"contained",color:"primary",onClick:function(){A.push(x)},children:"Upload New Image"}),Object(N.jsx)(k.a,{disabled:M||null===t.fetchMoreUrl,variant:"contained",color:"primary",onClick:function(){h.a.get(t.fetchMoreUrl,{headers:{Authorization:"Bearer ".concat(null===t||void 0===t?void 0:t.token)},params:{client_id:j,fields:"items(track(album(images,id))),total",response_type:p,limit:100,offset:w}}).then((function(e){var a;if(null===(a=e.data)||void 0===a?void 0:a.items){e.data.total>w+100?C(w+100):t.setFetchMoreUrl(null);var n=[],i=new m.a,c=t.uniqueTracks;e.data.items.forEach((function(t){c.find((function(e){return e.track.album.id===t.track.album.id}))||c.push(t)})),t.setUniqueTracks(c),c.forEach((function(e){i.getColorAsync(e.track.album.images[2].url).then((function(a){n.push({id:e.track.album.id,img:e.track.album.images[2].url,avgColour:a.value}),n.length===c.length&&(t.setTracks([].concat(Object(d.a)(t.tracks),n)),I(!0))}))}))}})).catch((function(t){console.log(t)}))},children:"Fetch More Tracks"}),Object(N.jsx)(k.a,{disabled:M,variant:"contained",color:"primary",onClick:function(){var t=document.createElement("a");t.href=E,t.setAttribute("download","mosaic.png"),document.body.appendChild(t),t.click()},children:"Download Mosaic"})]}),Object(N.jsx)("canvas",{hidden:!0,ref:R,width:i,height:u}),Object(N.jsx)("canvas",{hidden:!0,ref:L,width:64*i,height:64*u}),M?Object(N.jsx)("div",{className:V.loadingContainer,children:Object(N.jsx)(y.a,{})}):Object(N.jsxs)("div",{className:V.mosaicContainer,children:[Object(N.jsx)(U.a,{className:V.scrollContainer,children:Object(N.jsx)("img",{src:E,width:i*H,height:u*H,alt:"mosaic"})}),Object(N.jsx)("div",{className:V.sliderContainer,children:Object(N.jsx)(F.a,{value:H,onChange:function(t,e){z(e)},"aria-labelledby":"continuous-slider",min:1,max:64})})]})]})},D=a.p+"static/media/spotify.43abc2c0.png",E=function(){var t=Object(v.a)({scrollContainer:{maxHeight:"80%",maxWidth:"70%",display:"flex",alignItems:"center",justifyContent:"center"},spotifyImg:{height:"100vh",width:"100vh"},btnConnect:{margin:"2rem"}})();return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)("h1",{children:"Spotify Mosaic"}),Object(N.jsx)(U.a,{className:t.scrollContainer,children:Object(N.jsx)("img",{src:D,className:t.spotifyImg,alt:"Spotify Mosaic"})}),Object(N.jsx)(k.a,{variant:"contained",color:"primary",onClick:function(){var t=String(Math.floor(1e7*Math.random()));localStorage.setItem("authState",t),window.location.href="https://accounts.spotify.com/authorize?client_id=".concat(j,"&response_type=").concat(p,"&scope=").concat("user-top-read user-read-private user-read-email","&state=").concat(t,"&redirect_uri=").concat("https://losborne24.github.io/spotify-mosaic/")},className:t.btnConnect,children:"Connect to Spotify"})]})},P=a(58),R=a.n(P),L=a(73),A=function(t){var e=Object(l.k)(),a=function(e){t.createImg(e)};return Object(N.jsx)(N.Fragment,{children:Object(N.jsxs)(k.a,{variant:"contained",color:"primary",component:"label",children:["Select Image",Object(N.jsx)("input",{hidden:!0,onChange:function(t){if(t.target.files.length>0){var n=t.target.files[0],i=new FileReader;i.readAsDataURL(n),i.onload=function(){var t=Object(L.a)(R.a.mark((function t(n){var c;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=i.result,t.next=3,a(c);case 3:e.push(g);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},type:"file",accept:"image/*"})]})})},q=a(74),B=a.n(q),H=function(){var t=Object(n.useState)(),e=Object(r.a)(t,2),a=e[0],i=e[1],c=Object(n.useState)(null),s=Object(r.a)(c,2),d=s[0],u=s[1],h=Object(n.useState)([]),m=Object(r.a)(h,2),j=m[0],p=m[1],b=Object(n.useState)(""),f=Object(r.a)(b,2),y=f[0],k=f[1],w=Object(n.useState)([{id:"",img:"",avgColour:null}]),C=Object(r.a)(w,2),T=C[0],S=C[1],M=Object(n.useState)(!1),F=Object(r.a)(M,2),U=F[0],D=F[1],P=Object(v.a)({center:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center",height:"100%",width:"100%"}})();return Object(N.jsx)(o.HashRouter,{basename:"/spotify-mosaic",children:Object(N.jsxs)(B.a,{id:"G-MX2MXL5GQ2",debug:!0,children:[Object(N.jsxs)(l.g,{children:[Object(N.jsx)(l.d,{path:O,children:Object(N.jsx)("div",{className:P.center,children:Object(N.jsx)(I,{setToken:k,token:y,setTracks:S,returnToMosaic:U,setFetchMoreUrl:u,setUniqueTracks:p})})}),Object(N.jsx)(l.d,{path:"/:access_token(access_token=.*)",children:Object(N.jsx)("div",{className:P.center,children:Object(N.jsx)(I,{setToken:k,token:y,setTracks:S,returnToMosaic:U,setFetchMoreUrl:u,setUniqueTracks:p})})}),Object(N.jsx)(l.d,{path:x,children:Object(N.jsx)("div",{className:P.center,children:Object(N.jsx)(A,{createImg:function(t){return function(t){i(t)}(t)}})})}),Object(N.jsx)(l.d,{path:g,children:Object(N.jsx)(_,{fetchMoreUrl:d,setFetchMoreUrl:u,token:y,tracks:T,imageSrc:a,setReturnToMosaic:D,setUniqueTracks:p,uniqueTracks:j,setTracks:S})}),Object(N.jsx)(l.d,{path:"/",children:Object(N.jsx)("div",{className:P.center,children:Object(N.jsx)(E,{})})})]})," "]})})},z=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,158)).then((function(e){var a=e.getCLS,n=e.getFID,i=e.getFCP,c=e.getLCP,s=e.getTTFB;a(t),n(t),i(t),c(t),s(t)}))};s.a.render(Object(N.jsx)(i.a.StrictMode,{children:Object(N.jsx)(H,{})}),document.getElementById("root")),z()},84:function(t,e,a){}},[[113,1,2]]]);
//# sourceMappingURL=main.20556a1c.chunk.js.map